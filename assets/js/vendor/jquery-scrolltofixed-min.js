!function($){$.isScrollToFixed=function(o){return!!$(o).data("ScrollToFixed")},$.ScrollToFixed=function(o,i){function e(){T.trigger("preUnfixed.ScrollToFixed"),c(),T.trigger("unfixed.ScrollToFixed"),y=-1,v=T.offset().top,C=T.offset().left,g.options.offsets&&(C+=T.offset().left-T.position().left),-1==U&&(U=C),S=T.css("position"),F=!0,-1!=g.options.bottom&&(T.trigger("preFixed.ScrollToFixed"),r(),T.trigger("fixed.ScrollToFixed"))}function t(){var o=g.options.limit;return o?"function"==typeof o?o.apply(T):o:0}function n(){return"fixed"===S}function s(){return"absolute"===S}function l(){return!(n()||s())}function r(){if(!n()){var o=T[0].getBoundingClientRect();z.css({display:T.css("display"),width:o.width,height:o.height,float:T.css("float")}),cssOptions={"z-index":g.options.zIndex,position:"fixed",top:-1==g.options.bottom?x():"",bottom:-1==g.options.bottom?"":g.options.bottom,"margin-left":"0px"},g.options.dontSetWidth||(cssOptions.width=T.css("width")),T.css(cssOptions),T.addClass(g.options.baseClassName),g.options.className&&T.addClass(g.options.className),S="fixed"}}function d(){var o=t(),i=C;g.options.removeOffsets&&(i="",o-=v),cssOptions={position:"absolute",top:o,left:i,"margin-left":"0px",bottom:""},g.options.dontSetWidth||(cssOptions.width=T.css("width")),T.css(cssOptions),S="absolute"}function c(){l()||(y=-1,z.css("display","none"),T.css({"z-index":w,width:"",position:m,left:"",top:h,"margin-left":""}),T.removeClass("scroll-to-fixed-fixed"),g.options.className&&T.removeClass(g.options.className),S=null)}function p(o){o!=y&&(T.css("left",C-o),y=o)}function x(){var o=g.options.marginTop;return o?"function"==typeof o?o.apply(T):o:0}function f(){if($.isScrollToFixed(T)&&!T.is(":hidden")){var o=F,i=l();F?l()&&(v=T.offset().top,C=T.offset().left):e();var f=$(window).scrollLeft(),S=$(window).scrollTop(),b=t();g.options.minWidth&&$(window).width()<g.options.minWidth?l()&&o||(a(),T.trigger("preUnfixed.ScrollToFixed"),c(),T.trigger("unfixed.ScrollToFixed")):g.options.maxWidth&&$(window).width()>g.options.maxWidth?l()&&o||(a(),T.trigger("preUnfixed.ScrollToFixed"),c(),T.trigger("unfixed.ScrollToFixed")):-1==g.options.bottom?b>0&&S>=b-x()?i||s()&&o||(a(),T.trigger("preAbsolute.ScrollToFixed"),d(),T.trigger("unfixed.ScrollToFixed")):S>=v-x()?(n()&&o||(a(),T.trigger("preFixed.ScrollToFixed"),r(),y=-1,T.trigger("fixed.ScrollToFixed")),p(f)):l()&&o||(a(),T.trigger("preUnfixed.ScrollToFixed"),c(),T.trigger("unfixed.ScrollToFixed")):b>0?S+$(window).height()-T.outerHeight(!0)>=b-(x()||-u())?n()&&(a(),T.trigger("preUnfixed.ScrollToFixed"),"absolute"===m?d():c(),T.trigger("unfixed.ScrollToFixed")):(n()||(a(),T.trigger("preFixed.ScrollToFixed"),r()),p(f),T.trigger("fixed.ScrollToFixed")):p(f)}}function u(){return g.options.bottom?g.options.bottom:0}function a(){var o=T.css("position");"absolute"==o?T.trigger("postAbsolute.ScrollToFixed"):"fixed"==o?T.trigger("postFixed.ScrollToFixed"):T.trigger("postUnfixed.ScrollToFixed")}var g=this;g.$el=$(o),g.el=o,g.$el.data("ScrollToFixed",g);var F=!1,T=g.$el,S,m,b,h,w,v=0,C=0,U=-1,y=-1,z=null,A,O,N=function(o){T.is(":visible")?(F=!1,f()):c()},W=function(o){window.requestAnimationFrame?requestAnimationFrame(f):f()},B=function(){var o=document.body;if(document.createElement&&o&&o.appendChild&&o.removeChild){var i=document.createElement("div");if(!i.getBoundingClientRect)return null;i.innerHTML="x",i.style.cssText="position:fixed;top:100px;",o.appendChild(i);var e=o.style.height,t=o.scrollTop;o.style.height="3000px",o.scrollTop=500;var n=i.getBoundingClientRect().top;o.style.height=e;var s=100===n;return o.removeChild(i),o.scrollTop=t,s}return null},D=function(o){o=o||window.event,o.preventDefault&&o.preventDefault(),o.returnValue=!1};g.init=function(){g.options=$.extend({},$.ScrollToFixed.defaultOptions,i),w=T.css("z-index"),g.$el.css("z-index",g.options.zIndex),z=$("<div />"),S=T.css("position"),m=T.css("position"),b=T.css("float"),h=T.css("top"),l()&&g.$el.after(z),$(window).bind("resize.ScrollToFixed",N),$(window).bind("scroll.ScrollToFixed",W),"ontouchmove"in window&&$(window).bind("touchmove.ScrollToFixed",f),g.options.preFixed&&T.bind("preFixed.ScrollToFixed",g.options.preFixed),g.options.postFixed&&T.bind("postFixed.ScrollToFixed",g.options.postFixed),g.options.preUnfixed&&T.bind("preUnfixed.ScrollToFixed",g.options.preUnfixed),g.options.postUnfixed&&T.bind("postUnfixed.ScrollToFixed",g.options.postUnfixed),g.options.preAbsolute&&T.bind("preAbsolute.ScrollToFixed",g.options.preAbsolute),g.options.postAbsolute&&T.bind("postAbsolute.ScrollToFixed",g.options.postAbsolute),g.options.fixed&&T.bind("fixed.ScrollToFixed",g.options.fixed),g.options.unfixed&&T.bind("unfixed.ScrollToFixed",g.options.unfixed),g.options.spacerClass&&z.addClass(g.options.spacerClass),T.bind("resize.ScrollToFixed",function(){z.height(T.height())}),T.bind("scroll.ScrollToFixed",function(){T.trigger("preUnfixed.ScrollToFixed"),c(),T.trigger("unfixed.ScrollToFixed"),f()}),T.bind("detach.ScrollToFixed",function(o){D(o),T.trigger("preUnfixed.ScrollToFixed"),c(),T.trigger("unfixed.ScrollToFixed"),$(window).unbind("resize.ScrollToFixed",N),$(window).unbind("scroll.ScrollToFixed",W),T.unbind(".ScrollToFixed"),z.remove(),g.$el.removeData("ScrollToFixed")}),N()},g.init()},$.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1e3,baseClassName:"scroll-to-fixed-fixed"},$.fn.scrollToFixed=function(o){return this.each(function(){new $.ScrollToFixed(this,o)})}}(jQuery);