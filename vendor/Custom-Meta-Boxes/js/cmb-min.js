"use strict";var CMB={_initCallbacks:[],_clonedFieldCallbacks:[],_deletedFieldCallbacks:[],_sortStartCallbacks:[],_sortEndCallbacks:[],init:function(){jQuery(".field.repeatable").each(function(){CMB.isMaxFields(jQuery(this))}),jQuery(document).unbind("click.CMB"),jQuery(document).on("click.CMB",".cmb-delete-field",CMB.deleteField),jQuery(document).on("click.CMB",".repeat-field",CMB.repeatField),jQuery(document).on("click.CMB",".cmb-collapse-field",CMB.collapseField),jQuery(document).on("click.CMB",".postbox h3, .postbox .handlediv",CMB.init),CMB.doneInit(),jQuery(".field.cmb-sortable").each(function(){CMB.sortableInit(jQuery(this))})},repeatField:function(e){var t,a,l,i,d;if(l=jQuery(this).closest(".field"),e.preventDefault(),jQuery(this).blur(),!CMB.isMaxFields(l,1)){t=l.children(".field-item.hidden"),t.find(".cmb-collapse-field-icon.down").html("&uarr;").removeClass("down").addClass("up"),a=t.clone(),a.removeClass("hidden");a.find("input").not("[type=submit],[type=button],[type=checkbox],[type=radio],[readonly]").val(""),a.find(".cmb_upload_status").html(""),a.insertBefore(t),i=0,d=["id","name","for","data-id","data-name"],l.children(".field-item").not(t).each(function(){var e=l.hasClass("CMB_Group_Field")?/cmb-group-(\d|x)*/g:/cmb-field-(\d|x)*/g,t=l.hasClass("CMB_Group_Field")?"cmb-group-"+i:"cmb-field-"+i;jQuery(this).find("["+d.join("],[")+"]").each(function(){for(var a=0;a<d.length;a++)void 0!==jQuery(this).attr(d[a])&&jQuery(this).attr(d[a],jQuery(this).attr(d[a]).replace(e,t))}),i+=1}),CMB.clonedField(a),l.hasClass("cmb-sortable")&&CMB.sortableInit(l)}},deleteField:function(e){var t,a;e.preventDefault(),jQuery(this).blur(),confirm(CMBData.strings.confirmDeleteField)&&(t=jQuery(this).closest(".field-item"),a=t.closest(".field"),CMB.isMaxFields(a,-1),CMB.deletedField(t),t.remove())},collapseField:function(e){var t,a;e.preventDefault(),jQuery(this).blur(),t=jQuery(this).closest(".field-item").find(".cmb_metabox"),a=jQuery(this).find("span"),jQuery(this).find("span").hasClass("up")?CMB.closeField(t,a):CMB.openField(t,a)},closeField:function(e,t){t.html("&darr;"),t.removeClass("up").addClass("down"),e.hide()},openField:function(e,t){t.html("&uarr;"),t.removeClass("down").addClass("up"),e.show()},isMaxFields:function(e,t){var a,l,i,d,a;return t=t?parseInt(t,10):0,l=e.children(".repeat-field"),a=e.children(".field-item").not(".hidden").length+t,d=e.attr("data-rep-max"),e.find("> .field-item > .cmb-delete-field, > .field-item > .group > .cmb-delete-field").show(),void 0!==d&&(a>=parseInt(d,10)?l.attr("disabled","disabled"):l.removeAttr("disabled"),a>parseInt(d,10)||void 0)},addCallbackForInit:function(e){this._initCallbacks.push(e)},doneInit:function(){var e=this,t=CMB._initCallbacks;if(t)for(var a=0;a<t.length;a++)t[a]()},addCallbackForClonedField:function(e,t){if(jQuery.isArray(e))for(var a=0;a<e.length;a++)CMB.addCallbackForClonedField(e[a],t);this._clonedFieldCallbacks[e]=this._clonedFieldCallbacks[e]?this._clonedFieldCallbacks[e]:[],this._clonedFieldCallbacks[e].push(t)},clonedField:function(e){e.add(e.find("div[data-class]")).each(function(e,t){t=jQuery(t);var a=CMB._clonedFieldCallbacks[t.attr("data-class")];if(a)for(var l=0;l<a.length;l++)a[l](t)})},addCallbackForDeletedField:function(e,t){if(jQuery.isArray(e))for(var a=0;a<e.length;a++)CMB._deletedFieldCallbacks(e[a],t);this._deletedFieldCallbacks[e]=this._deletedFieldCallbacks[e]?this._deletedFieldCallbacks[e]:[],this._deletedFieldCallbacks[e].push(t)},deletedField:function(e){e.add(e.find("div[data-class]")).each(function(e,t){t=jQuery(t);var a=CMB._deletedFieldCallbacks[t.attr("data-class")];if(a)for(var l=0;l<a.length;l++)a[l](t)})},sortableInit:function(e){var t=e.find(" > .field-item").not(".hidden");e.find("> .field-item > .cmb-handle").remove(),t.each(function(){jQuery(this).append('<div class="cmb-handle"></div>')}),e.sortable({handle:"> .cmb-handle",cursor:"move",items:" > .field-item",beforeStop:function(e,t){CMB.sortStart(jQuery(t.item[0]))},deactivate:function(e,t){CMB.sortEnd(jQuery(t.item[0]))}})},sortStart:function(e){e.add(e.find("div[data-class]")).each(function(e,t){t=jQuery(t);var a=CMB._sortStartCallbacks[t.attr("data-class")];if(a)for(var l=0;l<a.length;l++)a[l](t)})},addCallbackForSortStart:function(e,t){if(jQuery.isArray(e))for(var a=0;a<e.length;a++)CMB.addCallbackForSortStart(e[a],t);this._sortStartCallbacks[e]=this._sortStartCallbacks[e]?this._sortStartCallbacks[e]:[],this._sortStartCallbacks[e].push(t)},sortEnd:function(e){e.add(e.find("div[data-class]")).each(function(e,t){t=jQuery(t);var a=CMB._sortEndCallbacks[t.attr("data-class")];if(a)for(var l=0;l<a.length;l++)a[l](t)})},addCallbackForSortEnd:function(e,t){if(jQuery.isArray(e))for(var a=0;a<e.length;a++)CMB.addCallbackForSortEnd(e[a],t);this._sortEndCallbacks[e]=this._sortEndCallbacks[e]?this._sortEndCallbacks[e]:[],this._sortEndCallbacks[e].push(t)}};jQuery(document).ready(function(){CMB.init()});